<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>jhub - nfe</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f6f8fb;
      }
      .wrap {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 18px;
        color: #222;
      }
      .spinner {
        width: 64px;
        height: 64px;
        border: 6px solid rgba(0, 0, 0, 0.08);
        border-top-color: #1976d2;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .message {
        font-size: 18px;
        font-weight: 600;
        color: #0f1720;
      }
      .hint {
        font-size: 13px;
        color: #5b6670;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <div class="wrap" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div class="message">Acessando o documento PDF via SIEG</div>
      <div class="hint">
        Por favor, aguarde — estamos consultando o SIEG para recuperar o
        documento.
      </div>
      <div
        id="fallback-hint"
        class="hint"
        style="display: none; margin-top: 8px; font-weight: 600; color: #b04a00"
      >
        Se a consulta ao SIEG demorar, iremos tentar gerar o DANFE a partir da
        NFE disponível em nosso banco local.
      </div>
    </div>

    <script>
      // Show fallback hint after 4 seconds; cancel if PDF arrives
      let fallbackTimer = setTimeout(() => {
        const fb = document.getElementById("fallback-hint");
        if (fb) fb.style.display = "block";
      }, 4000);

      window.addEventListener("message", (e) => {
        try {
          const data = e.data || {};

          // If PDF arrives, cancel timer and render it
          if (data.type === "pdfBlobUrl" && data.url) {
            clearTimeout(fallbackTimer);
            document.body.innerHTML =
              '<embed src="' +
              data.url +
              '" type="application/pdf" width="100%" height="100%">';
            return;
          }

          if (data.number) {
            document.title = "JHUB - DANFE " + data.number;
          }
        } catch (err) {
          console.error(err);
        }
      });
    </script>
  </body>
</html>
